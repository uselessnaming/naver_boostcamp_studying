# 아키텍처

[참고 자료 1](https://developer.android.com/topic/architecture?utm_source=chatgpt.com&hl=ko)

## 모바일 앱 사용자 환경
앱에서는 Activity, Fragment, Service, Content Provider, Broadcast Receiver를 비롯한 여러 구성 요소가 포함된다.

모바일 기기는 리소스가 제한되어있기 때문에 OS에서 새로운 앱을 위한 공간을 확보하도록 언제든지 일부 앱 프로세스를 종료할 수 있다

이런 환경 조건을 고려해볼 때 앱 구성요소는 개별적이고 비순차적으로 실행될 수 있으며, OS나 사용자가 언제든지 앱 구성요소를 소멸시킬 수 있다

따라서 이벤트 제어를 직접 못하기 때문에 **앱 구성 요소에 애플리케이션 데이터나 상태를 저장해서는 안되고 앱 구성 요소가 서로 종속**되면 안된다

## 일반 아키텍처 원칙
Android 앱은 크기가 커지기 때문에 앱을 **확장**하고 앱의 **견고성**을 높이며 앱을 **더 쉽게 테스트**할 수 있도록 아키텍처를 정의하는 것이 좋다

앱의 부분과 그 각 부분에 필요한 기능 간 경계를 정의한다

### 관심사 분리
**가장 중요한 원칙**        
Activity 혹은 Fragment 구현은 Android OS와 앱 사이의 계약을 나타내도록 이어주는 클래스일 뿐이다     
더 좋은 UX와 수월한 앱 관리 환경을 제공하기 위해 이런 클래스에 대한 의존성을 최소화하는 것이 좋다

### 데이터 모델에서 UI 도출하기
가급적 지속적인 모델을 권장한다     
데이터 모델은 **앱의 실제 데이터**를 관리하며, **앱의 UI 요소 및 기타 구성 요소로부터 독립**되어 있다       
즉, 이들은 UI 및 구성요소 수명 주기와는 관련이 없다     
다만 OS가 메모리에서 앱의 프로세스를 kill하면 데이터 모델 또한 삭제된다

+ Android OS에서 리소스를 확보하기 위해 앱을 제거해도 사용자 데이터가 삭제되지 않는다
+ 네트워크 연결이 취약하거나 연결되어 있지 않아도 앱이 계속 동작한다

### 단일 소스 저장소
새로운 데이터 유형을 정의할 때 데이터에 단일 소스 저장소(SSOT)를 할당해야 한다        
**SSOT는 데이터 소유자이며, SSOT 만이 데이터를 수정 혹은 변경할 수 있다**       
SSOT는 이를 위해 불변 유형을 사용해 데이터를 노출하며, 다른 유형이 호출할 수 있는 이벤트를 수신하거나 함수를 노출하여 데이터를 수정한다

+ 특정 유형 데이터의 모든 변경 사항을 한 곳으로 일원화한다
+ 다른 유형이 조작할 수 없도록 데이터를 보호
+ 데이터 변ㄱ여 사항을 더 쉽게 추적이 가능 >> 버그 발견 가능성 또한 높아짐

> Repository에서 Category 하나만을 관리하던 것을 생각하면 이해에 도움이 된다

### 단방향 데이터 흐름
**상태를 한 방향으로 / 이벤트는 반대 반향으로**

## 권장 앱 아키텍처
최소 2가지 Layer는 포함되어야 한다      

+ UI Layer : 화면에 앱 데이터를 표시
+ Data Layer : 앱의 비즈니스 로직을 포함하고 애플리케이션 데이터를 노출

UI Layer와 Data Layer 간 상호작용을 간소화하기 위해 Domain Layer를 추가할 수 있다 (Optional)

### 최신 앱 아키텍처
+ 반응형 및 계층형 아키텍처
+ 앱의 모든 Layer에서의 UDF
+ 상태 홀더가 있는 UI Layer로 UI 복잡성 관리
+ Coroutine 및 Flow
+ 종속 항목 삽입 권장사항(Hilt)

## UI Layer
화면에 데이터를 그리는 역할 (Data를 보여주기 위해 리소스로 치환하는 것은 그리는 역할이다)

사용자 상호작용 혹은 외부 입력으로 인해 데이터 변동 시 변경 사항을 반영하도록 UI가 업데이트 되어야 함

구성 요소
+ 화면에 데이터를 랜더링하는 UI 요소 (View 혹은 Composable)
+ 데이터를 보유하고 이를 UI 노출하며, 로직을 관리하는 State Holder (ViewModel)

## Data Layer
비즈니스 로직이 포함되어 있다.      
비즈니스 로직은 앱에 가치를 부여하는 요소 (앱의 데이터 생성, 저장, 변경 방식을 결정하는 규칙으로 구성)      

앱에서 처리하는 다양한 유형의 데이터별로 Repository 클래스를 생성해야 함

Repository 역할
+ 앱의 나머지 부분에 데이터 노출
+ 데이터 변경 사항을 한 곳에 집중
+ 여러 데이터 소스 간 충돌 해결
+ 앱의 나머지 부분에서 데이터 소스 추상화
+ 비즈니스 로직 포함

각 데이터 소스 클래스는 파일, 네트워크 소스, 로컬 데이터베이스와 같은 하나의 데이터 소스만 사용해야 한다        
데이터 소스 클래스는 데이터 작업을 위해 애플리케이션과 시스템 간 가교 역할을 한다

## Domain Layer
UI Layer와 Data Layer 사이에 있는 Layer (Optional)

복잡한 비즈니스 로직을 처리하거나 ViewModel에서 재사용성이 있는 간단한 비즈니스 로직을 캡슐화하는 Layer

필요에 의해서 하는 것이므로 필수가 아님

XXXUseCase를 보통 사용한다